<VirtualHost *:80>
    ServerName admcloud.local
    ServerAlias api.admcloud.local
    
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Rewrite Rules for CodeIgniter
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            
            # Redirecionar requests para index.php
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^(.*)$ index.php/$1 [L]
            
            # Remove index.php from URL
            RewriteCond %{THE_REQUEST} ^[^/]*/index\.php [NC]
            RewriteRule ^index\.php/(.*)$ /$1 [NC,R,L]
        </IfModule>
    </Directory>

    # Logs
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined

    # Gzip compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    # Security Headers
    <IfModule mod_headers.c>
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "no-referrer-when-downgrade"
    </IfModule>
</VirtualHost>
